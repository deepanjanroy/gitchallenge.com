{% extends "base.html" %}

{% block content %}
<script type="text/javascript">
var module = angular.module('tools', []);
module.factory('APIService', function($http) {
   return {
        getRepos: function(language, difficulty) {
            var url = '/api/repos/' + encodeURIComponent(language) + '/' +
                encodeURIComponent(difficulty);
            return $http.get(url).then(
                function(result) {
                    return result.data;
                });
        }
   }
});

module.controller('ToolCtrl', function($scope, APIService) {
    $scope.ready = false;
    $scope.repos = [];

    $scope.showProjects = function() {
        APIService.getRepos($scope.language, $scope.difficulty).then(function(repos) {
            $scope.repos = repos;
            $scope.ready = true;
            console.log($scope);
        });
    };
});
</script>

<div class="text-center" ng-app="tools" ng-controller="ToolCtrl">
    <div ng-hide='ready'>
        <h1>Choose a language</h1>

        <div class="btn-group">
            {% for language, _ in languages %}
            <button type="button" class="btn btn-lg" ng-click="language = '{{ language }}'">{{ language }}</button>
            {% endfor %}
        </div>

        <div ng-show='language.length'>
          <h1>Choose a degree of difficulty</h1>
          <div class="btn-group">
            {% for difficulty in difficulties %}
              <button type="button" class="btn btn-lg" ng-click="difficulty = '{{ difficulty }}'">{{ difficulty }}</button>
            {% endfor %}
          </div>
        </div>
        
        <div ng-show='difficulty.length'>
          <h1>Ready?</h1>
          <div class="main-button">
              <button type="button" class="btn btn-lg" ng-click="showProjects()">
                  Show me some projects to work on
              </button>
          </div>
        </div>
    </div>
    
    {% verbatim %}
    <div ng-show='ready'>
        <h1>We recommend the following {{difficulty}} {{language}} projects:</h1>
        <p>
            Don't like any of these projects?
        </p>
        <p>
            <button class="btn btn-lg" ng-click="showProjects()">Try again</button>
            <button class="btn btn-lg" ng-click="ready = false">Select different settings</button>
        </p>
        <hr />
        <div class="row">
            <div class="col-md-3">
                <h1 class="no-clear">Author</h1>
            </div>
            <div class="col-md-5">
                <h1 class="no-clear">Repository</h1>
            </div>
            <div class="col-md-4">
                <h1 class="no-clear">Level of difficulty</h1>
            </div>
        </div>
        <div class="row repository" ng-repeat="repo in repos">
            <br />
            <div class="col-md-1">
                <img ng-src="{{ repo.owner.avatar_url }}" class="gravatar" />
            </div>
            <div class="col-md-2">
                <h2>{{repo.owner.login}}</h2>
            </div>
            <div class="col-md-5">
                <h2 class="no-clear">{{repo.name}}</h2>
            </div>
            <div class="col-md-4">
                <h3 class="no-clear">
                    {{difficulty}}
                    <small><br />
                    {{repo.stargazers_count}} stars, {{repo.watchers_count}} watchers, {{repo.open_issues_count}} open issues, {{repo.forks_count}} forks</small>
                </h3>
            </div>
            <div class="col-md-12">
                <br />
                <p>{{repo.description}}</p>
            </div>
        </div>
    </div>
    {% endverbatim %}
</div>
{% endblock %}
